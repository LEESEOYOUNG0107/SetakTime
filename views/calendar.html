<!-- calendar.html -->

<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>SetakTime - Calendar</title>
    <link rel="stylesheet" href="style.css">

    <!-- FullCalendar Global ë¹Œë“œ (CSS + JS) -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

    <style>
        /* í† ìš”ì¼ íŒŒë‘, ì¼ìš”ì¼ ë¹¨ê°• */
        .fc-day-sat {
            color: #1e90ff !important;
        }

        .fc-day-sun {
            color: #ff4d4f !important;
        }
    </style>

</head>

<body>
    <header>
        <h1>SetakTime</h1>
        <nav>
            <a href="index.html">íšŒì›ê´€ë¦¬</a>
        </nav>
    </header>

    <div class="card">
        <h2 class="title">calendar</h2>
        <div id="calendar"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const calendarEl = document.getElementById('calendar');

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                height: 600,
                locale: 'ko', //í•œêµ­ì–´ ì„¤ì •

                // ì´ë²¤íŠ¸ ìŠ¤íƒ€ì¼
                eventDisplay: 'block',
                eventTextColor: '#fff',
                allDaySlot: true,

                // ë‚ ì§œ í´ë¦­ ì‹œ ë‚´ ì¼ì • ì¶”ê°€
                dateClick: function (info) {
                    // í•´ë‹¹ ë‚ ì§œì— ì´ë²¤íŠ¸ê°€ ì´ë¯¸ ìˆìœ¼ë©´ ì¶”ê°€ ê¸ˆì§€
                    const existing = calendar.getEvents().find(e => e.startStr === info.dateStr);
                    if (existing) {
                        alert('ì´ ë‚ ì€ ì´ë¯¸ ì¼ì •ì´ ìˆìŠµë‹ˆë‹¤ ğŸš«');
                        return;
                    }

                    if (confirm(`${info.dateStr} ë‚ ì§œë¥¼ ì˜ˆì•½ ë¶ˆê°€ë¡œ ì„¤ì •í• ê¹Œìš”?`)) {
                        calendar.addEvent({
                            title: 'ë‚´ ì¼ì • (ì˜ˆì•½ ë¶ˆê°€)',
                            start: info.dateStr,
                            allDay: true,
                            backgroundColor: '#8ecaff',
                            borderColor: '#8ecaff',
                            textColor: '#000'
                        });
                    }
                },

                // ì´ë²¤íŠ¸ í´ë¦­ ì²˜ë¦¬
                eventClick: function (info) {
                    const title = info.event.title;
                    if (title.includes('ë‚´ ì¼ì •')) {
                        alert('ì´ ë‚ ì€ ì˜ˆì•½ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤ âŒ');
                    } else {
                        alert('ê³µíœ´ì¼ì…ë‹ˆë‹¤ ğŸŒ•');
                    }
                    info.jsEvent.preventDefault();
                    info.jsEvent.stopPropagation(); // ë‚ ì§œ í´ë¦­ìœ¼ë¡œ ì´ì–´ì§€ëŠ” ê±¸ ë°©ì§€
                },

                // ê³µíœ´ì¼ API ë¶ˆëŸ¬ì˜¤ê¸°
                events: async (fetchInfo, successCallback, failureCallback) => {
                    try {
                        const res = await fetch(`/api/holidays?year=2025`);
                        if (!res.ok) throw new Error('API ì‘ë‹µ ì˜¤ë¥˜: ' + res.status);
                        const data = await res.json();

                        const holidays = (data.response && data.response.holidays)
                            ? data.response.holidays.map(h => ({
                                title: h.name,
                                start: h.date.iso,
                                allDay: true,
                                backgroundColor: '#ff6b6b',
                                borderColor: '#ff6b6b',
                                textColor: '#fff'
                            }))
                            : [];

                        if (holidays.length === 0) {
                            successCallback([
                                { title: 'ìƒ˜í”Œ ì¼ì • - ì‹œí—˜', start: new Date().toISOString().slice(0, 10), allDay: true, backgroundColor: '#ff6b6b', borderColor: '#ff6b6b' },
                                { title: 'ìƒ˜í”Œ ì¼ì • - ë°œí‘œ', start: new Date(Date.now() + 86400000).toISOString().slice(0, 10), allDay: true, backgroundColor: '#ff6b6b', borderColor: '#ff6b6b' }
                            ]);
                            return;
                        }

                        successCallback(holidays);
                    } catch (err) {
                        console.error("ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
                        failureCallback(err);
                        successCallback([
                            { title: 'ë¡œì»¬ ìƒ˜í”Œ - ì¼ì • ì—†ìŒ', start: new Date().toISOString().slice(0, 10), allDay: true, backgroundColor: '#ff6b6b' }
                        ]);
                    }
                }
            });

            calendar.render();
        });
    </script>
</body>

</html>