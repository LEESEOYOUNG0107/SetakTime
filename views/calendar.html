<!-- calendar.html : ì„¸íƒ ì˜ˆì•½ ë¶ˆê°€ì¼ì„ í‘œì‹œí•˜ëŠ” ë‹¬ë ¥ í˜ì´ì§€ -->

<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>SetakTime - Calendar</title>

    <!-- ì™¸ë¶€ ìŠ¤íƒ€ì¼ì‹œíŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° -->
    <link rel="stylesheet" href="style.css">

    <!-- FullCalendar (ë‹¬ë ¥ ë¼ì´ë¸ŒëŸ¬ë¦¬) ì „ì—­ ë²„ì „ ë¶ˆëŸ¬ì˜¤ê¸° -->
    <!-- CSSì™€ JSë¥¼ í•œ ë²ˆì— í¬í•¨ -->
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

    <style>
        /* ë‹¬ë ¥ì˜ ìš”ì¼ ìƒ‰ìƒ ì»¤ìŠ¤í„°ë§ˆì´ì§• */
        /* í† ìš”ì¼ì€ íŒŒë€ìƒ‰ */
        .fc-day-sat {
            color: #1e90ff !important;
        }

        /* ì¼ìš”ì¼ì€ ë¹¨ê°„ìƒ‰ */
        .fc-day-sun {
            color: #ff4d4f !important;
        }
    </style>

</head>

<body>
    <!-- ìƒë‹¨ í—¤ë” ì˜ì—­ -->
    <header>
        <!-- ë¡œê³  í´ë¦­ ì‹œ ë©”ì¸ í˜ì´ì§€ë¡œ ì´ë™ -->
        <a href="/main.html" style="text-decoration: none; color: inherit;">
            <h1>SetakTime</h1>
        </a>

        <!-- ë‚´ë¹„ê²Œì´ì…˜ ë©”ë‰´ -->
        <nav>
            <a href="/main.html">í™ˆ</a>
            <a href="/reserve">ì„¸íƒ ì˜ˆì•½</a>
        </nav>
    </header>

    <!-- ë‹¬ë ¥ ì¹´ë“œ ì˜ì—­ -->
    <div class="card">
        <h2 class="title">calendar</h2>
        <!-- FullCalendarê°€ í‘œì‹œë  ìœ„ì¹˜ -->
        <div id="calendar"></div>
    </div>

    <script>
        // HTMLì´ ëª¨ë‘ ë¡œë“œëœ í›„ ì‹¤í–‰
        document.addEventListener('DOMContentLoaded', function () {
            // ë‹¬ë ¥ì„ í‘œì‹œí•  DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
            const calendarEl = document.getElementById('calendar');

            // FullCalendar ê°ì²´ ìƒì„±
            const calendar = new FullCalendar.Calendar(calendarEl, {
                // ì²˜ìŒ ë³´ì´ëŠ” ë‹¬ë ¥ í˜•íƒœ: ì›” ë‹¨ìœ„(dayGridMonth)
                initialView: 'dayGridMonth',
                // ë‹¬ë ¥ ë†’ì´ ì„¤ì •
                height: 600,
                // í•œêµ­ì–´ë¡œ í‘œì‹œ
                locale: 'ko',

                // ì´ë²¤íŠ¸(ì¼ì •) í‘œì‹œ ìŠ¤íƒ€ì¼
                eventDisplay: 'block',  // ë¸”ë¡ í˜•íƒœë¡œ í‘œì‹œ
                eventTextColor: '#fff', // ì´ë²¤íŠ¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ
                allDaySlot: true,       // í•˜ë£¨ ì¢…ì¼ ìŠ¬ë¡¯ í‘œì‹œ

                /* ==============================
                   [ë‚ ì§œ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬]
                ===============================*/
                dateClick: function (info) {
                    // ì´ë¯¸ í•´ë‹¹ ë‚ ì§œì— ì¼ì •ì´ ìˆëŠ”ì§€ í™•ì¸
                    const existing = calendar.getEvents().find(e => e.startStr === info.dateStr);
                    if (existing) {
                        alert('ì´ ë‚ ì€ ì´ë¯¸ ì¼ì •ì´ ìˆìŠµë‹ˆë‹¤ ğŸš«');
                        return; // ì¤‘ë³µ ì¶”ê°€ ë°©ì§€
                    }

                    // ì‚¬ìš©ìì—ê²Œ í™•ì¸ ë©”ì‹œì§€ í‘œì‹œ
                    if (confirm(`${info.dateStr} ë‚ ì§œë¥¼ ì˜ˆì•½ ë¶ˆê°€ë¡œ ì„¤ì •í• ê¹Œìš”?`)) {
                        // ì‚¬ìš©ìê°€ í™•ì¸í•˜ë©´ ìƒˆ ì¼ì • ì¶”ê°€
                        calendar.addEvent({
                            title: 'ë‚´ ì¼ì • (ì˜ˆì•½ ë¶ˆê°€)',  // ì¼ì • ì œëª©
                            start: info.dateStr,           // ì„ íƒí•œ ë‚ ì§œ
                            allDay: true,                  // í•˜ë£¨ì¢…ì¼ ì´ë²¤íŠ¸ë¡œ ì„¤ì •
                            backgroundColor: '#8ecaff',    // ë°°ê²½ìƒ‰
                            borderColor: '#8ecaff',        // í…Œë‘ë¦¬ìƒ‰
                            textColor: '#000'              // ê¸€ììƒ‰
                        });
                    }
                },

                /* ==============================
                   [ì´ë²¤íŠ¸ í´ë¦­ ì‹œ ì²˜ë¦¬]
                ===============================*/
                eventClick: function (info) {
                    const title = info.event.title;

                    // "ë‚´ ì¼ì •"ì´ë©´ ì˜ˆì•½ ë¶ˆê°€ ì•ˆë‚´
                    if (title.includes('ë‚´ ì¼ì •')) {
                        alert('ì´ ë‚ ì€ ì˜ˆì•½ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤ âŒ');
                    } else {
                        // ê·¸ ì™¸ì—ëŠ” ê³µíœ´ì¼ë¡œ ê°„ì£¼
                        alert('ê³µíœ´ì¼ì…ë‹ˆë‹¤ ğŸŒ•');
                    }

                    // í´ë¦­ ì´ë²¤íŠ¸ ë²„ë¸”ë§(ì¤‘ì²© ë™ì‘) ë°©ì§€
                    info.jsEvent.preventDefault();
                    info.jsEvent.stopPropagation();
                },

                /* ==============================
                   [ê³µíœ´ì¼ API ë¶ˆëŸ¬ì˜¤ê¸°]
                   FullCalendarì˜ events ì†ì„±ì€
                   ë¹„ë™ê¸° í•¨ìˆ˜ë¡œ ì„œë²„ì—ì„œ ì¼ì • ë°ì´í„°ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆìŒ
                ===============================*/
                events: async (fetchInfo, successCallback, failureCallback) => {
                    try {
                        // ë°±ì—”ë“œ API í˜¸ì¶œ (/api/holidays?year=2025)
                        const res = await fetch(`/api/holidays?year=2025`);
                        if (!res.ok) throw new Error('API ì‘ë‹µ ì˜¤ë¥˜: ' + res.status);

                        // JSON í˜•íƒœë¡œ ì‘ë‹µ íŒŒì‹±
                        const data = await res.json();

                        // ì‘ë‹µ ë°ì´í„° êµ¬ì¡°ì— ë”°ë¼ holidays ë°°ì—´ ì¶”ì¶œ
                        const holidays = (data.response && data.response.holidays)
                            ? data.response.holidays.map(h => ({
                                title: h.name,           // ê³µíœ´ì¼ ì´ë¦„
                                start: h.date.iso,       // ë‚ ì§œ (ISO í˜•ì‹)
                                allDay: true,            // í•˜ë£¨ì¢…ì¼ ì´ë²¤íŠ¸
                                backgroundColor: '#ff6b6b', // ë°°ê²½ìƒ‰ (ë¹¨ê°•)
                                borderColor: '#ff6b6b',     // í…Œë‘ë¦¬ìƒ‰
                                textColor: '#fff'           // ê¸€ììƒ‰
                            }))
                            : [];

                        // ê³µíœ´ì¼ì´ ì—†ì„ ê²½ìš° ìƒ˜í”Œ ì¼ì • í‘œì‹œ
                        if (holidays.length === 0) {
                            successCallback([
                                {
                                    title: 'ìƒ˜í”Œ ì¼ì • - ì‹œí—˜',
                                    start: new Date().toISOString().slice(0, 10),
                                    allDay: true,
                                    backgroundColor: '#ff6b6b',
                                    borderColor: '#ff6b6b'
                                },
                                {
                                    title: 'ìƒ˜í”Œ ì¼ì • - ë°œí‘œ',
                                    start: new Date(Date.now() + 86400000).toISOString().slice(0, 10),
                                    allDay: true,
                                    backgroundColor: '#ff6b6b',
                                    borderColor: '#ff6b6b'
                                }
                            ]);
                            return;
                        }

                        // ì„±ê³µì ìœ¼ë¡œ ê³µíœ´ì¼ ì¼ì • ì¶”ê°€
                        successCallback(holidays);
                    } catch (err) {
                        // ì—ëŸ¬ ë°œìƒ ì‹œ ì½˜ì†” ì¶œë ¥ ë° ì‹¤íŒ¨ ì½œë°± ì‹¤í–‰
                        console.error("ì¼ì • ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
                        failureCallback(err);

                        // ì‹¤íŒ¨ ì‹œ ë¡œì»¬ í…ŒìŠ¤íŠ¸ìš© ì¼ì • í‘œì‹œ
                        successCallback([
                            {
                                title: 'ë¡œì»¬ ìƒ˜í”Œ - ì¼ì • ì—†ìŒ',
                                start: new Date().toISOString().slice(0, 10),
                                allDay: true,
                                backgroundColor: '#ff6b6b'
                            }
                        ]);
                    }
                }
            });

            // ë‹¬ë ¥ ë Œë”ë§
            calendar.render();
        });
    </script>
</body>

</html>