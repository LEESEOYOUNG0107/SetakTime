<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SetakTime - 로그인</title>
    <link rel="stylesheet" href="/style/login.css">
    <link rel="preconnect" href="https://fonts.googleapis.com"> <!--구글 폰트 서버 연결1-->
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <!--연결2-->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Noto+Sans+KR:wght@400;500&display=swap"
        rel="stylesheet"> <!--원하는 폰트로 연결-->
</head>

<body>
    <header>
        <div class="header-container">
            <h1 class="logo">SetakTime</h1>
            <nav>
                <ul>
                    <li><a href="/main.html">홈</a></li>
                    <li><a href="signup.html">회원가입</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="login-container">
            <h2 class="main-logo">SetakTime</h2>
            <div class="login-box">
                <h3>Login</h3>
                <form id="loginForm">
                    <input type="text" name="userid" placeholder="Id" required>
                    <input type="password" name="password" placeholder="Pw" required>
                    <button type="submit" class="btn-ok">Login</button>
                </form>
                <script>
                    const form = document.getElementById('loginForm');

                    form.addEventListener('submit', function (e) {
                        e.preventDefault(); // 기본 제출 막기

                        const formData = new FormData(form);
                        const data = Object.fromEntries(formData.entries());

                        fetch('http://localhost:3000/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data)
                        })
                            .then(async res => {
                                if (res.ok) {
                                    const data = await res.json();
                                    alert(data.message);
                                    if (data.role === 'teacher') {
                                        window.location.href = '/admin_students.html'; // 선생님은 학생 관리 페이지로 이동
                                    } else {
                                        window.location.href = '/main.html'; // 학생은 메인 페이지로
                                    }
                                } else {
                                    const errorText = await res.text();
                                    alert('로그인 실패: ' + errorText);
                                }
                            })
                            .catch(err => {
                                console.error(err);
                                alert('로그인 요청 중 오류가 발생했습니다.');
                            });
                    });
                </script>
            </div>
        </div>
    </main>
</body>

</html>